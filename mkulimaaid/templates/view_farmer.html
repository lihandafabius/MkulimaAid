{% extends "base.html" %}
{% block content %}
<!-- Page Title -->
<h2 class="mt-4">Farmer Profile Overview</h2>

<!-- Basic Farmer Information -->
<div class="farmer-info card mt-4">
    <div class="card-body text-center">
        <!-- Profile Picture -->
        {% if farmer.avatar %}
            <img class="rounded-circle mt-3 shadow-lg border border-3 border-success"
                 width="170px" height="170px"
                 src="{{ url_for('static', filename='uploads/' + farmer.avatar) }}"
                 alt="Profile Picture">
        {% else %}
            <img class="rounded-circle mt-3 shadow-lg border border-3 border-secondary"
                 width="150px" height="150px"
                 src="{{ url_for('static', filename='images/default.png') }}"
                 alt="Default Avatar">
        {% endif %}

        <!-- Full Name and Username -->
        <h4 class="mt-3">{{ farmer.fullname }}</h4>
        <p><strong>Username:</strong> {{ farmer.username }}</p>

        <!-- Location and Join Date -->
        <p><strong>Location:</strong> {{ farmer.location }}</p>
        <p><strong>Joined:</strong>
            {% if farmer.date_joined %}
                {{ farmer.date_joined.strftime('%B %d, %Y') }}
            {% else %}
                Date not available
            {% endif %}
        </p>
    </div>
</div>


<!-- Dashboard Overview Section -->
<div class="row mt-4">
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5>Total Questions Asked</h5>
                <h3 class="text-primary">{{ total_questions }}</h3>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5>Total Answers Given</h5>
                <h3 class="text-success">{{ total_answers }}</h3>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5>Total Comments</h5>
                <h3 class="text-warning">{{ total_comments }}</h3>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5>Total Messages Sent</h5>
                <h3 class="text-danger">{{ total_messages }}</h3>
            </div>
        </div>
    </div>
</div>

<!-- Interaction Visualizations -->
<div class="row mt-4">
    <!-- Questions and Answers Over Time -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Questions & Answers Over Time</h5>
                <canvas id="questionsAnswersChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Comments by Month -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Comments Submitted (Monthly)</h5>
                <canvas id="commentsChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Messages Sent Over Time -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Messages Sent Over Time</h5>
                <canvas id="messagesChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Top Topics Interacted With -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Top Topics Interacted With</h5>
                <canvas id="topicsChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Load JavaScript Libraries -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const questionsAnswersData = {
        labels: {{ questions_labels | safe }},
        datasets: [
            {
                label: 'Questions',
                data: {{ questions_values | safe }},
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            },
            {
                label: 'Answers',
                data: {{ answers_values | safe }},
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }
        ]
    };

    const commentsData = {
        labels: {{ messages_labels | safe }},
        datasets: [{
            label: 'Messages',
            data: {{ messages_values | safe }},
            backgroundColor: 'rgba(255, 206, 86, 0.5)',
            borderColor: 'rgba(255, 206, 86, 1)',
            borderWidth: 1
        }]
    };

    const topicsData = {
        labels: {{ topics_labels | safe }},
        datasets: [{
            label: 'Interactions',
            data: {{ topics_values | safe }},
            backgroundColor: 'rgba(153, 102, 255, 0.5)',
            borderColor: 'rgba(153, 102, 255, 1)',
            borderWidth: 1
        }]
    };

    // Create Charts
    new Chart(document.getElementById('questionsAnswersChart').getContext('2d'), {
        type: 'line',
        data: questionsAnswersData,
        options: { responsive: true }
    });

    new Chart(document.getElementById('commentsChart').getContext('2d'), {
        type: 'bar',
        data: commentsData,
        options: { responsive: true }
    });

    new Chart(document.getElementById('messagesChart').getContext('2d'), {
        type: 'line',
        data: commentsData,
        options: { responsive: true }
    });

    new Chart(document.getElementById('topicsChart').getContext('2d'), {
        type: 'pie',
        data: topicsData,
        options: { responsive: true }
    });
</script>
{% endblock %}
