{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Notifications</h2>

    <!-- Filters and Search Bar -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="btn-group" role="group" aria-label="Notification filters">
            <button type="button" class="btn btn-outline-primary active" id="filter-all">All</button>
            <button type="button" class="btn btn-outline-primary" id="filter-active">Active</button>
            <button type="button" class="btn btn-outline-primary" id="filter-archived">Archived</button>
        </div>
        <div class="input-group" style="max-width: 300px;">
            <input type="text" class="form-control" id="search-notifications" placeholder="Search notifications" aria-label="Search notifications">
            <button class="btn btn-primary" type="button" onclick="searchNotifications()">Search</button>
        </div>
    </div>

    <!-- Notifications List -->
    <div class="list-group" id="notifications-list">
        {% if notifications %}
            {% for notification in notifications %}
            <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-archived="{{ notification.is_archived }}">
                <div>
                    <h5 class="mb-1">{{ notification.title }}</h5>
                    <p class="mb-1">{{ notification.message }}</p>
                    <small class="text-muted">Sent on {{ notification.date_sent.strftime('%b %d, %Y') }}</small>
                </div>
                <div>
                    <!-- Mark as Read Button -->
                    <form method="POST" action="{{ url_for('main.mark_notification_read', notification_id=notification.id) }}" class="d-inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button class="btn btn-outline-success btn-sm me-2" type="submit">Mark as Read</button>
                    </form>
                    <!-- Archive Button -->
                    <form method="POST" action="{{ url_for('main.archive_notification', notification_id=notification.id) }}" class="d-inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button class="btn btn-outline-secondary btn-sm" type="submit">Archive</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="alert alert-info text-center">
                No notifications available.
            </div>
        {% endif %}
    </div>
</div>

<script>
    // JavaScript for filtering notifications
    document.getElementById('filter-all').addEventListener('click', () => {
        showAllNotifications();
    });

    document.getElementById('filter-active').addEventListener('click', () => {
        filterActiveNotifications();
    });

    document.getElementById('filter-archived').addEventListener('click', () => {
        filterArchivedNotifications();
    });

    function searchNotifications() {
        const query = document.getElementById('search-notifications').value.toLowerCase();
        const notifications = document.querySelectorAll('#notifications-list .list-group-item');
        notifications.forEach(notification => {
            const title = notification.querySelector('h5').innerText.toLowerCase();
            const message = notification.querySelector('p').innerText.toLowerCase();
            if (title.includes(query) || message.includes(query)) {
                notification.style.display = '';
            } else {
                notification.style.display = 'none';
            }
        });
    }

    function showAllNotifications() {
        const notifications = document.querySelectorAll('#notifications-list .list-group-item');
        notifications.forEach(notification => notification.style.display = '');
    }

    function filterActiveNotifications() {
        const notifications = document.querySelectorAll('#notifications-list .list-group-item');
        notifications.forEach(notification => {
            const isArchived = notification.dataset.archived === 'true';
            notification.style.display = isArchived ? 'none' : '';
        });
    }

    function filterArchivedNotifications() {
        const notifications = document.querySelectorAll('#notifications-list .list-group-item');
        notifications.forEach(notification => {
            const isArchived = notification.dataset.archived === 'true';
            notification.style.display = isArchived ? '' : 'none';
        });
    }
</script>
{% endblock %}
