{% extends "base.html" %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-lg">
                <div class="card-header bg-success text-white">
                    <h3 class="mb-0">Change Password</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('main.change_password') }}">
                        {{ form.hidden_tag() }}

                        <!-- Current Password Field -->
                        <div class="form-group position-relative">
                            <label for="current_password">Current Password</label>
                            {{ form.current_password(class="form-control", id="current_password", placeholder="Enter your current password", type="password") }}
                            <span id="toggle-password-icon-current" class="position-absolute top-50 mt-2 end-0 translate-middle-y me-3" onclick="togglePasswordVisibility('current_password', 'toggle-password-icon-current')" style="cursor: pointer;" data-bs-toggle="tooltip" title="Show Password">
                                <!-- Show Password Icon (Eye) -->
                                <svg id="show-eye-icon-current" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                    <path d="M12 5C5.5 5 2 12 2 12s3.5 7 10 7 10-7 10-7-3.5-7-10-7z"></path>
                                    <circle cx="12" cy="12" r="2.5"></circle>
                                    <path d="M12 8v8M8 12h8" opacity="0.2"></path> <!-- Subtle cross as decoration -->
                                </svg>

                                <!-- Hide Password Icon (Eye with Slash) -->
                                <svg id="hide-eye-icon-current" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="display: none;">
                                    <path d="M17.94 17.94C15.68 19.41 13.27 20 12 20 5.5 20 2 12 2 12c1.52-3.11 3.91-5.83 6.78-7.22"></path>
                                    <circle cx="12" cy="12" r="2.5"></circle>
                                    <path d="M3 3l18 18"></path>
                                    <path d="M9.88 9.88A3 3 0 0 0 12 15a3 3 0 0 0 2.12-5.12" opacity="0.4"></path>
                                </svg>
                            </span>
                            {% if form.current_password.errors %}
                                <div class="text-danger small">{{ form.current_password.errors[0] }}</div>
                            {% endif %}
                        </div>

                        <!-- New Password Field -->
                        <div class="form-group position-relative">
                            <label for="new_password">New Password</label>
                            {{ form.new_password(class="form-control", id="new_password", placeholder="Enter a new password", type="password") }}
                            <span id="toggle-password-icon-new" class="position-absolute top-50 mt-2 end-0 translate-middle-y me-3" onclick="togglePasswordVisibility('new_password', 'toggle-password-icon-new')" style="cursor: pointer;" data-bs-toggle="tooltip" title="Show Password">
                                <!-- Show Password Icon (Eye) -->
                                <svg id="show-eye-icon-new" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                    <path d="M12 5C5.5 5 2 12 2 12s3.5 7 10 7 10-7 10-7-3.5-7-10-7z"></path>
                                    <circle cx="12" cy="12" r="2.5"></circle>
                                    <path d="M12 8v8M8 12h8" opacity="0.2"></path> <!-- Subtle cross as decoration -->
                                </svg>

                                <!-- Hide Password Icon (Eye with Slash) -->
                                <svg id="hide-eye-icon-new" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="display: none;">
                                    <path d="M17.94 17.94C15.68 19.41 13.27 20 12 20 5.5 20 2 12 2 12c1.52-3.11 3.91-5.83 6.78-7.22"></path>
                                    <circle cx="12" cy="12" r="2.5"></circle>
                                    <path d="M3 3l18 18"></path>
                                    <path d="M9.88 9.88A3 3 0 0 0 12 15a3 3 0 0 0 2.12-5.12" opacity="0.4"></path>
                                </svg>
                            </span>
                            {% if form.new_password.errors %}
                                <div class="text-danger small">{{ form.new_password.errors[0] }}</div>
                            {% endif %}
                        </div>

                        <!-- Confirm New Password Field -->
                        <div class="form-group position-relative">
                            <label for="confirm_password">Confirm New Password</label>
                            {{ form.confirm_password(class="form-control", id="confirm_password", placeholder="Re-enter the new password", type="password") }}
                            <span id="toggle-password-icon-confirm" class="position-absolute top-50 mt-2 end-0 translate-middle-y me-3" onclick="togglePasswordVisibility('confirm_password', 'toggle-password-icon-confirm')" style="cursor: pointer;" data-bs-toggle="tooltip" title="Show Password">
                                <!-- Show Password Icon (Eye) -->
                                <svg id="show-eye-icon-confirm" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                                    <path d="M12 5C5.5 5 2 12 2 12s3.5 7 10 7 10-7 10-7-3.5-7-10-7z"></path>
                                    <circle cx="12" cy="12" r="2.5"></circle>
                                    <path d="M12 8v8M8 12h8" opacity="0.2"></path> <!-- Subtle cross as decoration -->
                                </svg>

                                <!-- Hide Password Icon (Eye with Slash) -->
                                <svg id="hide-eye-icon-confirm" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="display: none;">
                                    <path d="M17.94 17.94C15.68 19.41 13.27 20 12 20 5.5 20 2 12 2 12c1.52-3.11 3.91-5.83 6.78-7.22"></path>
                                    <circle cx="12" cy="12" r="2.5"></circle>
                                    <path d="M3 3l18 18"></path>
                                    <path d="M9.88 9.88A3 3 0 0 0 12 15a3 3 0 0 0 2.12-5.12" opacity="0.4"></path>
                                </svg>
                            </span>
                            {% if form.confirm_password.errors %}
                                <div class="text-danger small">{{ form.confirm_password.errors[0] }}</div>
                            {% endif %}
                        </div>

                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-outline-success fw-bold px-4">Update Password</button>
                            <a href="{{ url_for('main.profile') }}" class="btn btn-outline-danger fw-bold px-4">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="text-center mt-4">
    <a href="{{ url_for('main.profile') }}"
       class="btn btn-outline-success fw-bold">
       <i class="fas fa-arrow-left"></i> Back to Profile <i class="fas fa-user"></i>
    </a>
</div>
</div>
{% endblock %}

{% block scripts %}
<script>
function togglePasswordVisibility(inputId, iconId) {
    var input = document.getElementById(inputId);
    var iconContainer = document.getElementById(iconId);
    var eyeIcon = iconContainer.querySelector('[id^="show-eye-icon"]');
    var eyeSlashIcon = iconContainer.querySelector('[id^="hide-eye-icon"]');

    if (input.type === "password") {
        input.type = "text";
        eyeIcon.style.display = "none";
        eyeSlashIcon.style.display = "inline-block";
    } else {
        input.type = "password";
        eyeIcon.style.display = "inline-block";
        eyeSlashIcon.style.display = "none";
    }
}
</script>
{% endblock %}
